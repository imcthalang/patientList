<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏±‡∏î - ‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
    body { font-family: 'Sarabun', sans-serif; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .tab-button.active { background-color: #3b82f6; color: white; }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
  <div class="container mx-auto px-4 py-6">
    <!-- Header -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
      <h1 class="text-3xl font-bold text-gray-800 text-center">‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏±‡∏î</h1>
      <p class="text-gray-600 text-center mt-2">‡πÅ‡∏ú‡∏ô‡∏Å‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î</p>
    </div>

    <!-- Tab Navigation -->
    <div class="bg-white rounded-lg shadow-lg mb-6">
      <div class="flex flex-wrap border-b">
        <button class="tab-button active px-6 py-3 font-medium text-sm rounded-tl-lg hover:bg-blue-50 transition-colors" onclick="showTab('outpatient')">‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ô‡∏≠‡∏Å</button>
        <button class="tab-button px-6 py-3 font-medium text-sm hover:bg-blue-50 transition-colors" onclick="showTab('inpatient')">‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÉ‡∏ô</button>
        <button class="tab-button px-6 py-3 font-medium text-sm hover:bg-blue-50 transition-colors" onclick="showTab('copd')">‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å COPD</button>
        <button class="tab-button px-6 py-3 font-medium text-sm hover:bg-blue-50 transition-colors" onclick="showTab('dm')">‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å DM</button>
        <button class="tab-button px-6 py-3 font-medium text-sm rounded-tr-lg hover:bg-blue-50 transition-colors" onclick="showTab('elderly')">‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</button>
      </div>

      <!-- Outpatient Tab -->
      <div id="outpatient" class="tab-content active p-6">
<h2 class="text-2xl font-semibold text-gray-800 mb-6">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ô‡∏≠‡∏Å</h2>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
  <button onclick="showForm()" 
    class="mb-4 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-lg">
    ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  </button>

  <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ -->
  <div class="overflow-x-auto mb-6">
    <table class="min-w-full bg-white rounded-lg shadow">
      <thead>
        <tr class="bg-gray-200 text-gray-700">
          <th class="px-4 py-2">ID</th>
          <th class="px-4 py-2">HN</th>
          <th class="px-4 py-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
          <th class="px-4 py-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
          <th class="px-4 py-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th>
          <th class="px-4 py-2">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
      </thead>
      <tbody id="opdTableBody"></tbody>
    </table>
  </div>

       <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏° (‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å) -->
  <div id="opdFormContainer" class="hidden">
    <h2 class="text-2xl font-semibold text-gray-800 mb-6">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ô‡∏≠‡∏Å</h2>
    <form id="opdForm" class="space-y-6">
      <input type="hidden" id="formAction" name="action" value="add">
      <input type="hidden" id="formId" name="id">

          <!-- ‡πÅ‡∏ñ‡∏ß 1: ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô + ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢ + ‡∏ô‡∏±‡∏Å‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</label>
              <input type="date" id="regDate" name="date" class="w-full px-3 py-2 border border-gray-300 rounded-md">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</label>
              <select id="patientType" name="type" class="w-full px-3 py-2 border border-gray-300 rounded-md" onchange="updateFormFields()">
                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</option>
                <option value="Ortho">Ortho</option>
                <option value="Neuro">Neuro</option>
                <option value="Chest">Chest</option>
                <option value="IMC">IMC</option>
                <option value="Home & Education">Home & Education</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ô‡∏±‡∏Å‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏Å‡∏©‡∏≤</label>
              <select id="ptSelect" name="pT" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î</option>
              </select>
            </div>
          </div>

          <!-- ‡πÅ‡∏ñ‡∏ß 2: ‡∏£‡∏≠‡∏ö‡∏ô‡∏±‡∏î + ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î + ‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏±‡∏î -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≠‡∏ö‡∏ô‡∏±‡∏î‡∏£‡∏±‡∏Å‡∏©‡∏≤</label>
              <div id="roundOptions" name="round" class="space-y-2"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î‡∏£‡∏±‡∏Å‡∏©‡∏≤</label>
              <div id="dayOptions" name="day" class="grid grid-cols-3 gap-2"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î‡∏£‡∏±‡∏Å‡∏©‡∏≤</label>
              <div id="timeOptions" name="time" class="grid grid-cols-2 gap-2"></div>
            </div>
          </div>

<!-- ‡πÅ‡∏ñ‡∏ß: ID + HN + ‡∏ä‡∏∑‡πà‡∏≠ -->
<div class="grid grid-cols-4 gap-4">
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-2">ID</label>
    <input type="text" id="idField" name="ptId" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100" readonly>
  </div>
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-2">HN</label>
    <input type="text" id="hnInput" name="hn" maxlength="7" class="w-full px-3 py-2 border border-gray-300 rounded-md">
  </div>
  <div class="col-span-2">
    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
    <input type="text" id="ptName" name="name" class="w-full px-3 py-2 border border-gray-300 rounded-md">
  </div>
</div>


          <!-- ‡πÅ‡∏ñ‡∏ß 4: ‡∏≠‡∏≤‡∏¢‡∏∏ + ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å + ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á + ‡∏£‡∏≠‡∏ö‡πÄ‡∏≠‡∏ß -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏≤‡∏¢‡∏∏</label>
              <div class="flex space-x-2">
                <input type="number" id="ageYear" placeholder="‡∏õ‡∏µ" class="w-1/2 px-3 py-2 border border-gray-300 rounded-md">
                <input type="number" id="ageMonth" placeholder="‡πÄ‡∏î‡∏∑‡∏≠‡∏ô" class="w-1/2 px-3 py-2 border border-gray-300 rounded-md">
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏Å‡∏Å.)</label>
              <input type="number" id="weight" name="weight" step="0.1" class="w-full px-3 py-2 border border-gray-300 rounded-md">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (‡∏ã‡∏°.)</label>
              <input type="number" id="hight" name="hight" class="w-full px-3 py-2 border border-gray-300 rounded-md">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≠‡∏ö‡πÄ‡∏≠‡∏ß</label>
              <div class="flex space-x-2">
                <input type="number" id="waistInput" class="w-2/3 px-3 py-2 border border-gray-300 rounded-md">
                <select id="waistUnit" class="w-1/3 px-2 py-2 border border-gray-300 rounded-md">
                  <option value="cm">‡∏ã‡∏°.</option>
                  <option value="inch">‡∏ô‡∏¥‡πâ‡∏ß</option>
                </select>
              </div>
            </div>
          </div>

    <!-- ‡πÅ‡∏ñ‡∏ß 5: ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå + ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤ + ‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß -->
<div class="grid grid-cols-1 md:grid-cols-5 gap-4">
  <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå -->
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
    <input type="text" id="phone" name="phone" pattern="[0-9]{10}" maxlength="10"
      class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
    <p id="phoneError" class="text-red-500 text-sm hidden">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå 10 ‡∏´‡∏•‡∏±‡∏Å</p>
  </div>

  <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤ -->
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤</label>
    <select id="mwSelect" name="mw" class="w-full px-3 py-2 border border-gray-300 rounded-md">
      <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤</option>
    </select>
  </div>

  <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3-5: ‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß -->
  <div class="col-span-3">
    <label class="block text-sm font-medium text-gray-700 mb-2">‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</label>
    <div class="flex flex-wrap gap-4">
      <label><input type="checkbox" class="mr-2"> ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</label>
      <label><input type="checkbox" class="mr-2"> HT</label>
      <label><input type="checkbox" class="mr-2"> DM</label>
      <label><input type="checkbox" class="mr-2"> DLP</label>
      <label><input type="checkbox" class="mr-2"> CKD</label>
      <label><input type="checkbox" class="mr-2"> Heart disease</label>
      <label><input type="checkbox" class="mr-2"> CVA</label>
      <input type="text" placeholder="‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏£‡∏∞‡∏ö‡∏∏)"
        class="px-3 py-2 border border-gray-300 rounded-md">
    </div>
  </div>
</div>

<!-- ‡πÅ‡∏ñ‡∏ß 7-8 ‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô: ‡∏ö‡∏≤‡∏î‡πÄ‡∏à‡πá‡∏ö‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô + ‡πÄ‡∏Ñ‡∏¢‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û + ‡πÅ‡∏û‡πâ‡∏¢‡∏≤ + ‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà + ‡∏î‡∏∑‡πà‡∏° -->
<div class="grid grid-cols-1 md:grid-cols-5 gap-4">
  <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô -->
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô?</label>
    <label class="mr-4"><input type="radio" name="workRelated" value="‡πÉ‡∏ä‡πà"> ‡πÉ‡∏ä‡πà</label>
    <label><input type="radio" name="workRelated" value="‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà"> ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà</label>
  </div>

  <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏Ñ‡∏¢‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û -->
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-2">3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤‡πÄ‡∏Ñ‡∏¢‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?</label>
    <label class="mr-4"><input type="radio" name="previousService" value="‡πÉ‡∏ä‡πà"> ‡πÉ‡∏ä‡πà</label>
    <label><input type="radio" name="previousService" value="‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà"> ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà</label>
  </div>

  <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡πÅ‡∏û‡πâ‡∏¢‡∏≤ -->
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-2">‡πÅ‡∏û‡πâ‡∏¢‡∏≤</label>
    <label class="mr-4"><input type="radio" name="drugAllergy" value="‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò"> ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</label>
    <label><input type="radio" name="drugAllergy" value="‡∏°‡∏µ"> ‡∏°‡∏µ</label>
  </div>

  <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà -->
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà</label>
    <label class="mr-4"><input type="radio" name="smoking" value="‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢"> ‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢</label>
    <label class="mr-4"><input type="radio" name="smoking" value="‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß"> ‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß</label>
    <label><input type="radio" name="smoking" value="‡∏™‡∏π‡∏ö"> ‡∏™‡∏π‡∏ö</label>
  </div>

  <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 5: ‡∏î‡∏∑‡πà‡∏° -->
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏î‡∏∑‡πà‡∏°‡πÅ‡∏≠‡∏•‡∏Å‡∏≠‡∏Æ‡∏≠‡∏•‡πå</label>
    <label class="mr-4"><input type="radio" name="alcohol" value="‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢"> ‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢</label>
    <label class="mr-4"><input type="radio" name="alcohol" value="‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß"> ‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß</label>
    <label><input type="radio" name="alcohol" value="‡∏î‡∏∑‡πà‡∏°"> ‡∏î‡∏∑‡πà‡∏°</label>
  </div>
</div>

        <!-- ‡πÅ‡∏ñ‡∏ß 9: ‡πÅ‡∏û‡∏ó‡∏¢‡πå + Dx -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
  <!-- ‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á -->
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á</label>
    <input type="text" id="doctorName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏û‡∏ó‡∏¢‡πå"
      class="w-full px-3 py-2 border border-gray-300 rounded-md">
    <div class="mt-2">
      <label><input type="radio" name="refDoctor" value="‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å"> ‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å</label>
    </div>
  </div>

  <!-- ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå -->
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå</label>
    <textarea id="medDx" name="medDx" class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="2"></textarea>
  </div>

  <!-- ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û -->
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û</label>
    <select id="dxSelect" name="ptDx" class="w-full px-3 py-2 border border-gray-300 rounded-md">
      <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢</option>
    </select>
  </div>
</div>

          <div class="col-span-full">
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-8 rounded-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ô‡∏≠‡∏Å</button>
          </div>
        </form>
      </div>
    </div>
  </div>

            <!-- Inpatient Tab -->
            <div id="inpatient" class="tab-content p-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÉ‡∏ô</h2>
                <form class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</label>
                        <input type="date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</label>
                        <input type="text" value="‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÉ‡∏ô" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100" readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">AN</label>
                        <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">HN</label>
                        <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠ ‡∏™‡∏Å‡∏∏‡∏•</label>
                        <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏≤‡∏¢‡∏∏</label>
                        <input type="number" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤</label>
                        <select id="mwSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</label>
                        <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢</option>
                            <option value="‡∏´‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ä‡∏≤‡∏¢">‡∏´‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ä‡∏≤‡∏¢</option>
                            <option value="‡∏´‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏´‡∏ç‡∏¥‡∏á">‡∏´‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏´‡∏ç‡∏¥‡∏á</option>
                            <option value="‡∏´‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ä‡∏±‡πâ‡∏ô 4">‡∏´‡∏≠‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ä‡∏±‡πâ‡∏ô 4</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ô‡∏±‡∏Å‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏Å‡∏©‡∏≤</label>
                        <select id="ptSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î</option>
                        </select>
                    </div>
                    <div class="col-span-full">
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå</label>
                        <textarea class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3"></textarea>
                    </div>
                    <div class="col-span-full">
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î</label>
                        <select id="dxSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î</option>
                        </select>
                    </div>
                    <div class="col-span-full">
                        <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-8 rounded-lg transition-colors">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÉ‡∏ô
                        </button>
                    </div>
                </form>
            </div>

            <!-- COPD Clinic Tab -->
            <div id="copd" class="tab-content p-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å COPD</h2>
                <form class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</label>
                        <input type="date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">HN</label>
                        <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠ ‡∏™‡∏Å‡∏∏‡∏•</label>
                        <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏≤‡∏¢‡∏∏</label>
                        <input type="number" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤</label>
                        <select id="mwSelect" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤</option>
				</select>
                          </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢ (1-10)</label>
                        <input type="number" min="1" max="10" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏î‡πâ (‡πÄ‡∏°‡∏ï‡∏£)</label>
                        <input type="number" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="col-span-full">
                        <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white font-medium py-3 px-8 rounded-lg transition-colors">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å COPD
                        </button>
                    </div>
                </form>
            </div>

            <!-- DM Clinic Tab -->
            <div id="dm" class="tab-content p-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å DM</h2>
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center">
                    <p class="text-yellow-800">‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å DM ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤</p>
                    <p class="text-sm text-yellow-600 mt-1">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô</p>
                </div>
            </div>

            <!-- Elderly Clinic Tab -->
            <div id="elderly" class="tab-content p-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏</h2>
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center">
                    <p class="text-yellow-800">‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ ‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤</p>
                    <p class="text-sm text-yellow-600 mt-1">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô</p>
                </div>
            </div>
        </div>
    </div>


  <!-- Scripts -->
  <script>
const API_URL = "https://script.google.com/macros/s/AKfycbwD10wC2tYDuYtOz32TS2Qg4cfwDdaJ3pu_YtnrLgR_a_V1cVkZqytFCNACoREWQ6QgLQ/exec";

// ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á
function loadOPDTable() {
  fetch(API_URL + "?action=read")
    .then(res => res.json())
    .then(data => {
      const tbody = document.getElementById("opdTableBody");
      tbody.innerHTML = "";
      if (!data || data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6" class="text-center py-4 text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`;
        return;
      }
      data.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="border px-4 py-2">${row.ptId || ""}</td>
          <td class="border px-4 py-2">${row.hn || ""}</td>
          <td class="border px-4 py-2">${row.name || ""}</td>
          <td class="border px-4 py-2">${row.type || ""}</td>
          <td class="border px-4 py-2">${row.phone || ""}</td>
          <td class="border px-4 py-2">
            <button class="bg-yellow-500 text-white px-2 py-1 rounded" onclick="editData('${row.ptId}')">‚úèÔ∏è</button>
            <button class="bg-red-600 text-white px-2 py-1 rounded" onclick="deleteData('${row.ptId}')">üóëÔ∏è</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    })
    .catch(err => {
      console.error("‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", err);
      alert("‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    });
}
document.addEventListener("DOMContentLoaded", loadOPDTable);

// --- Helper functions ---
function getDays() {
  return Array.from(document.querySelectorAll('input[name="day"]:checked'))
              .map(cb => cb.value).join(" - ");
}

function getUD() {
  const container = document.querySelector('.col-span-3 .flex');
  const checked = [];

  container.querySelectorAll('input[type="checkbox"]').forEach(cb => {
    if (cb.checked) checked.push(cb.nextSibling.textContent.trim());
  });

  const otherInput = container.querySelector('input[type="text"]');
  if (otherInput && otherInput.value.trim() !== '') {
    checked.push(otherInput.value.trim());
  }
  return checked.join(' - ');
}

function showForm(data = null) {
  document.getElementById("opdFormContainer").classList.remove("hidden");
  const formAction = document.getElementById("formAction");
  const formId = document.getElementById("formId");

  if (data) {
    // ‚úÖ ‡∏Å‡∏£‡∏ì‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    formAction.value = "update";
    formId.value = data.ptId || "";
    document.getElementById("idField").value = data.ptId || "";
    document.getElementById("hnInput").value = data.hn || "";
    document.getElementById("ptName").value = data.name || "";
    document.getElementById("patientType").value = data.type || "";
    document.getElementById("phone").value = data.phone || "";
    document.getElementById("weight").value = data.weight || "";
    document.getElementById("hight").value = data.hight || "";
    document.getElementById("mwSelect").value = data.mw || "";
    document.getElementById("medDx").value = data.medDx || "";
    document.getElementById("dxSelect").value = data.ptDx || "";

    // ‚úÖ ‡∏≠‡∏≤‡∏¢‡∏∏
    if (data.age) {
      const ageMatch = data.age.match(/(\d+)‡∏õ‡∏µ(\d+)‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/);
      if (ageMatch) {
        document.getElementById("ageYear").value = ageMatch[1];
        document.getElementById("ageMonth").value = ageMatch[2];
      }
    }

    // ‚úÖ ‡∏£‡∏≠‡∏ö‡πÄ‡∏≠‡∏ß
    if (data.waist) document.getElementById("waistInput").value = data.waist;

    // ‚úÖ ‡∏ô‡∏±‡∏Å‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î
    if (data.pT) {
      document.getElementById("ptSelect").value = data.pT;
    }

    // ‚úÖ ‡∏£‡∏≠‡∏ö‡∏ô‡∏±‡∏î + ‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î + ‡πÄ‡∏ß‡∏•‡∏≤
    if (data.type) {
      updateFormFields(); // render ‡∏£‡∏≠‡∏ö‡∏ô‡∏±‡∏î‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
      if (data.round) {
        const roundRadio = document.querySelector(`input[name="round"][value="${data.round}"]`);
        if (roundRadio) {
          roundRadio.checked = true;
          setRound(data.round); // render ‡∏ß‡∏±‡∏ô+‡πÄ‡∏ß‡∏•‡∏≤
        }
      }

      // ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å setRound ‡πÅ‡∏•‡πâ‡∏ß ‚Üí check ‡∏ß‡∏±‡∏ô
      if (data.day) {
        const days = data.day.split(" - ");
        document.querySelectorAll('input[name="day"]').forEach(cb => {
          cb.checked = days.includes(cb.value);
        });
      }

      // check ‡πÄ‡∏ß‡∏•‡∏≤
      if (data.time) {
        const timeInput = document.querySelector(`input[name="time"][value="${data.time}"]`);
        if (timeInput) timeInput.checked = true;
      }
    }

    // ‚úÖ ‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß (ud)
    if (data.ud) {
      const udItems = data.ud.split(" - ");
      document.querySelectorAll('.col-span-3 input[type="checkbox"]').forEach(cb => {
        cb.checked = udItems.includes(cb.nextSibling.textContent.trim());
      });
      const extra = udItems.find(v => {
        return !Array.from(document.querySelectorAll('.col-span-3 input[type="checkbox"]'))
                     .some(cb => cb.nextSibling.textContent.trim() === v);
      });
      if (extra) {
        document.querySelector('.col-span-3 input[type="text"]').value = extra;
      }
    }

    // ‚úÖ radio group (work, previousService, drugAllergy, smoking, alcohol, refDoctor)
    const radioMap = {
      work: "workRelated",
      month3: "previousService",
      drug: "drugAllergy",
      smoke: "smoking",
      alcohal: "alcohol",
      refDoctor: "refDoctor"
    };
    Object.keys(radioMap).forEach(field => {
      if (data[field]) {
        const radio = document.querySelector(`input[name="${radioMap[field]}"][value="${data[field]}"]`);
        if (radio) radio.checked = true;
      }
    });

    // ‚úÖ ‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á
    if (data.doctor) {
      const radioDoctor = document.querySelector(`input[name="refDoctor"][value="${data.doctor}"]`);
      if (radioDoctor) {
        radioDoctor.checked = true;
      } else {
        document.getElementById("doctorName").value = data.doctor;
      }
    }

  } else {
    // ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏û‡∏¥‡πà‡∏°
    formAction.value = "add";
    formId.value = "";
    document.getElementById("opdForm").reset();
  }
}


// --- ‡∏Å‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ---
async function editData(id) {
  try {
    const res = await fetch(API_URL + `?action=get&id=${id}`);
    const data = await res.json();
    if (data.status === "error") {
      alert(data.message);
      return;
    }
    showForm(data); // ‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
  } catch (err) {
    console.error("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", err);
    alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏î‡πâ");
  }
}

// --- ‡∏ü‡∏≠‡∏£‡πå‡∏° submit ---
document.getElementById("opdForm").addEventListener("submit", async function(e) {
  e.preventDefault();
  const formData = new FormData(this);

  // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤ checkbox ‡πÅ‡∏•‡∏∞ radio ‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß
  formData.set("day", getDays());
  formData.set("ud", getUD());

  try {
    const res = await fetch(API_URL, { method: "POST", body: formData });
    const result = await res.json();
    if (result.status === "success") {
      alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      this.reset();
      document.getElementById("opdFormContainer").classList.add("hidden");
      loadOPDTable();
    } else {
      alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + result.message);
    }
  } catch (err) {
    console.error(err);
    alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
  }
});


// ‡∏Å‡∏î‡∏•‡∏ö
function deleteData(id) {
  if (confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ?")) {
    fetch(API_URL + `?action=delete&id=${id}`)
      .then(res => res.json())
      .then(res => {
        if (res.status === "success") {
          alert("‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
          loadOPDTable();
        } else {
          alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + res.message);
        }
      });
  }
}
    // ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Google Apps Script
    document.addEventListener("DOMContentLoaded", () => {
      const url = "https://script.google.com/macros/s/AKfycby-00vDlcr6KJrlWx5nJ2CUSCNCsZqfLRDODsbUw8PChJgZN6wTzhcXyj41bjF17u4Z/exec";
      fetch(url)
        .then(res => res.json())
        .then(data => {
          fillSelect("ptSelect", data.pt);
          fillSelect("mwSelect", data.mw);
          fillSelect("dxSelect", data.dx);
        })
        .catch(err => console.error("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", err));
    });
    function fillSelect(selectId, items) {
      const select = document.getElementById(selectId);
      items.forEach(item => {
        const opt = document.createElement("option");
        opt.value = item;
        opt.textContent = item;
        select.appendChild(opt);
      });
    }

    // --- ‡πÅ‡∏ó‡πá‡∏ö ---
    function showTab(tabName, event) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tabName).classList.add('active');
      if(event) event.currentTarget.classList.add('active');
    }

    // ‡∏£‡∏≠‡∏ö‡∏ô‡∏±‡∏î + PT ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç
    function updateFormFields() {
      const type = document.getElementById('patientType').value;
      const roundContainer = document.getElementById('roundOptions');
      const ptSelect = document.getElementById('ptSelect');
      roundContainer.innerHTML = "";
      let rounds = [];
      if (type === 'Ortho') {
        rounds = ['‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£', '‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£'];
      } else if (type === 'Neuro' || type === 'IMC' || type === 'Chest') {
        rounds = ['‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£'];
      }
      rounds.forEach(r => {
        const opt = document.createElement('label');
        opt.innerHTML = `<input type="radio" name="round" value="${r}" onchange="setRound('${r}')"> ${r}`;
        roundContainer.appendChild(opt);
      });
      if (type === 'Neuro' || type === 'IMC') {
        ptSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î</option>';
      }
    }
    function setRound(round) {
      const type = document.getElementById('patientType').value;
      const dayContainer = document.getElementById('dayOptions');
      const timeContainer = document.getElementById('timeOptions');
      const ptSelect = document.getElementById('ptSelect');
      dayContainer.innerHTML = "";
      timeContainer.innerHTML = "";
      let days = [], times = [];
      if (type === 'Ortho' && round === '‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£') {
        days = ['‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå','‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£','‡∏û‡∏∏‡∏ò','‡∏û‡∏§‡∏´‡∏±‡∏™','‡∏®‡∏∏‡∏Å‡∏£‡πå','‡πÄ‡∏™‡∏≤‡∏£‡πå'];
        times = ['9:00','9:30','10:00','10:30','11:00','13:00','13:30','14:00','14:30','15:00'];
      } else if (type === 'Ortho' && round === '‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£') {
        days = ['‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå','‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£','‡∏û‡∏∏‡∏ò','‡∏û‡∏§‡∏´‡∏±‡∏™','‡∏®‡∏∏‡∏Å‡∏£‡πå'];
        times = ['16:30','17:00','17:30','18:00','18:30','19:00'];
        ptSelect.innerHTML = '<option value="- ALL -">- ALL -</option>';
      } else if ((type === 'Neuro' || type === 'IMC' || type === 'Chest') && round === '‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£') {
        days = ['‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå','‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£','‡∏û‡∏∏‡∏ò','‡∏û‡∏§‡∏´‡∏±‡∏™','‡∏®‡∏∏‡∏Å‡∏£‡πå'];
        times = ['10:00','10:30','11:00','14:00','15:00'];
      }
      days.forEach(d => {
        const opt = document.createElement('label');
        opt.innerHTML = `<input type="checkbox" name="day" value="${d}"> ${d}`;
        dayContainer.appendChild(opt);
      });
      times.forEach(t => {
        const opt = document.createElement('label');
        opt.innerHTML = `<input type="radio" name="time" value="${t}"> ${t}`;
        timeContainer.appendChild(opt);
      });
    }

    // ID ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å HN + ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡∏û.‡∏®.)
    function generateID() {
      const hnInput = document.getElementById('hnInput');
      const idField = document.getElementById('idField');
      hnInput.addEventListener('input', () => {
        let hn = hnInput.value.trim();
        if (/^\d+$/.test(hn) && hn.length > 0) {
          hn = hn.padStart(7, '0');
          const now = new Date();
          const buddhistYear = now.getFullYear() + 543;
          const year = String(buddhistYear).slice(-2);
          const month = String(now.getMonth() + 1).padStart(2, '0');
          const day = String(now.getDate()).padStart(2, '0');
          idField.value = `${year}${month}${day}OP${hn}`;
        } else { idField.value = ''; }
      });
    }
    document.addEventListener('DOMContentLoaded', generateID);

    // Toggle ‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á
    function toggleDoctorInput() {
      const internal = document.querySelector('input[name="refDoctor"][value="internal"]');
      const doctorInput = document.getElementById('doctorName');
      doctorInput.disabled = !internal.checked;
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå
    document.getElementById('phone').addEventListener('input', function() {
      const phoneError = document.getElementById('phoneError');
      if (/^\d{10}$/.test(this.value)) {
        phoneError.classList.add('hidden');
      } else {
        phoneError.classList.remove('hidden');
      }
    });
    // Set today's date as default
            const dateInputs = document.querySelectorAll('input[type="date"]');
            const today = new Date().toISOString().split('T')[0];
            dateInputs.forEach(input => {
                input.value = today;
            });
function getUD() {
  const container = document.querySelector('.col-span-3 .flex');
  const checked = [];
  
  // ‡πÄ‡∏Å‡πá‡∏ö checkbox ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
  container.querySelectorAll('input[type="checkbox"]').forEach(cb => {
    if (cb.checked) checked.push(cb.nextSibling.textContent.trim());
  });
  
  // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤ text input ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
  const otherInput = container.querySelector('input[type="text"]');
  if (otherInput && otherInput.value.trim() !== '') {
    checked.push(otherInput.value.trim());
  }
  
  return checked.join(' - '); // ‡∏™‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô string ‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢ " - "
}

 </script>
</body>
</html>


